<!DOCTYPE html>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<html>

<head>
  <title>Librarian</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

  <script src="javascripts/download.js"></script>
</head>
<body>
<p class="display-4 text-center">Librarian: Files</p>
<div class="mb-3">
  <label for="logout" class="form-label">Cancel and log in again</label>
  <button id="logout" name="logout" onclick="window.location.href = '/logout';">Sign out</button>
</div>

  <div class="container">
  <div class="btn-group" role="group" id="allfiles" aria-label="Select">
    <input type="checkbox" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked>
    <label class="btn btn-outline-primary" for="btnradio1">Show old (downloaded) files</label>

    <input type="checkbox" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off" checked>
    <label class="btn btn-outline-primary" for="btnradio2">Show new files</label>
  </div>
  </div>
  <script>
    function downloader(id, fname) {
      var x = new XMLHttpRequest();
      var ct = '';
      x.open("GET", "/download/" + id, true);
      x.responseType = 'blob';
      x.onreadystatechange = () => {
        if (x.readyState === this.HEADERS_RECEIVED) {
          ct = x.getResponseHeader("content-type");
        }
      }
      x.onload = () => {
        download(x.response, fname, x.response.type);
      };
      x.send();
      //const resp = fetch('/download/' + id, () => {});
    }
  </script>
  <ul class="list-group">
    <% files.forEach((f) => { %>
    <li class="list-group-item" data-dlinfo="<%=f.downloads ? f.downloads.length : 0%>" onclick="downloader('<%=f.idstr%>','<%=f.name%>')">
      <%=f.filenumber%> <a href="#"><%= f.docname%></a>
    </li>
    <% }) %>
  </ul>

  <script>
    allfiles.onchange = () => {
      alert(btnradio1.checked);
      if (btnradio1.checked) {
        $('ul > [data-dlinfo="0"]').show();
        $('ul > [data-dlinfo="1"]').hide();
      } else {
        $('ul > [data-dlinfo="1"]').show();
        $('ul > [data-dlinfo="0"]').hide();
      }
    }
  </script>


</body>

</html>
