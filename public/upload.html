<!DOCTYPE html>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload files</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- bootstrap javascript reuqires jquery -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body>
<p class="display-4 text-center">Librarian: upload files</p>
<div class="mb-3">
    <label for="logout" class="form-label">Cancel and log in again</label>
    <button id="logout" name="logout" onclick="window.location.href = '/logout';">Sign out</button>
</div>
<form method="POST" action="/upload" enctype="multipart/form-data" id="mainform">
    <div class="mb-3">
        <label for="formFile" class="form-label fw-bold">Select files to add to library:</label>
        <input class="form-control" type="file" name="formFiles" id="formFiles" multiple>
    </div>
</form>
<script>
    function filedetails(n) {
        return `
        <div class="mb-3">
            <label for="filename${n}" class="form-label">Upload Filename:</label>
            <input type="text" class="form-control" name="filename${n}" id="filename${n}" readonly>
        </div>
        <div class="mb-3">
            <label for="filenumber${n}" class="form-label">Number (optional):</label>
            <input type="text" class="form-control" name="filenumber${n}" id="filenumber${n}">
        </div>
        <div class="mb-3">
            <label for="docname${n}" class="form-label">Document name (optional)</label>
            <input type="text" class="form-control" name="docname${n}" id="docname${n}">
        </div>
      `;
    }

    function initCap(name) {
        let words = name.split(' ');
        let wnew = [];
        for (var i = 0; i < words.length; i++) {
            words[i] = words[i].charAt(0).toUpperCase() + words[i].slice(1);
        }
        return words.join(' ');
    }

    mainform = document.getElementById("mainform");
    formElement = document.getElementById("formFiles");
    formElement.addEventListener("input", (event) => {
        for (var i = 1; i <= formElement.files.length; i++) {
            var f = formElement.files[i-1];
            mainform.insertAdjacentHTML('beforeend', filedetails(i));
            document.getElementById(`filename${i}`).value = f.name;
            var fname1 = f.name.replaceAll('-',' ');
            var result = fname1.match(/([^0-9]*)([0-9]*)\.(.*)/);
            let fnameShow = initCap(result[1].trim());

            document.getElementById(`docname${i}`).value = fnameShow;
            document.getElementById(`filenumber${i}`).value = result[2].trim();
        }
        mainform.insertAdjacentHTML('beforeend',`<input type="submit">`);
    })
</script>
</body>
</html>
