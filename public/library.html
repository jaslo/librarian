<!DOCTYPE html>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<html>

<head>
  <title>Librarian</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body>
<p class="display-4 text-center">Librarian: Files</p>
<div class="mb-3">
  <label for="logout" class="form-label">Cancel and log in again</label>
  <button id="logout" name="logout" onclick="window.location.href = '/logout';">Sign out</button>
</div>

  <div class="container">
  <div class="btn-group" role="group" id="allfiles" aria-label="Select">
    <!--

<input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off">
<label class="btn btn-outline-primary" for="btnradio3">Show all files</label>

<input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">
<label class="btn btn-outline-primary" for="btnradio2">Show old (downloaded) files</label>

<input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off">
<label class="btn btn-outline-primary" for="btnradio1">Show new files</label>
-->

    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="inlineRadioOptions" id="btnradio3" value="option1">
      <label class="form-check-label" for="btnradio3">Show all files</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="inlineRadioOptions" id="btnradio2" value="option2">
      <label class="form-check-label" for="btnradio2">Show old (downloaded) files</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="inlineRadioOptions" id="btnradio1" value="option3">
      <label class="form-check-label" for="btnradio1">Show new files</label>
    </div>
  </div>
  </div>
  <script>
    function downloader(id, fname) {
      window.location = '/download/' + id;
    }
  </script>
<div class="container">
  <ul class="list-group">
    <% files.forEach((f) => {
      if (f.name) { %>
    <li class="list-group-item border-0" data-dlinfo="<%=f.downloads ? 1 : 0%>" onclick="downloader('<%=f.idstr%>','<%=f.name%>')">
      <%=f.filenumber%>
      <a href="#"><%= f.docname%></a>
      <% } else { %>
    <li class="list-group-item border-0" data-dlinfo="x" onclick="downloader('<%=f.idstr%>','<%=f.name%>')">
      <%=f.filenumber%>
        <%= f.docname%>
      <% } %>
    </li>
    <% }) %>
  </ul>
</div>

  <script>
    function radiobuttonflags() {
      return btnradio1.checked << 2 | btnradio2.checked << 1 | btnradio3.checked
    }

    allfiles.onchange = () => hideshowfiles(radiobuttonflags());
      //alert(btnradio1.checked);

    var currentPage;
    function setupPage(page) {
      currentPage = page;
    }

    function hideshowfiles(flags) {
      // 4 new files (btnradio1)
      // 2  old (btnradio2)
      // 1 all (btnradio3)

      history.replaceState(currentPage,"","?flags=" + flags);

      if (flags & 4) { // undownloaded files
        document.getElementById("btnradio1").checked = true;

        $('ul > [data-dlinfo="0"]').show();
        $('ul > [data-dlinfo="x"]').hide();
        $('ul > [data-dlinfo="1"]').hide();
      } else if (flags & 2) { // downloaded
        document.getElementById("btnradio2").checked = true;

        $('ul > [data-dlinfo="1"]').show();
        $('ul > [data-dlinfo="x"]').hide();
        $('ul > [data-dlinfo="0"]').hide();
      } else {
        document.getElementById("btnradio3").checked = true;

        $('ul > [data-dlinfo="x"]').show();
        $('ul > [data-dlinfo="1"]').show();
        $('ul > [data-dlinfo="0"]').show();
      }
    }


    hideshowfiles(<%=flags || 1%>);

  </script>


</body>

</html>
